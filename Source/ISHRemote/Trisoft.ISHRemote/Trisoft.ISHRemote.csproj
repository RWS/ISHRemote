<Project Sdk="Microsoft.NET.Sdk">

  <PropertyGroup>
    <TargetFrameworks>netcoreapp3.1;net5.0;net472</TargetFrameworks>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <CopyLocalLockFileAssemblies>true</CopyLocalLockFileAssemblies>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="PowerShellStandard.Library" Version="7.0.0-preview.1" Condition="'$(TargetFramework)' != 'net5.0'" />
    <PackageReference Include="Microsoft.PowerShell.Commands.Management" Version="7.1.3" Condition="'$(TargetFramework)' == 'net5.0'" />
    <PackageReference Include="System.Net.Http" Version="4.3.4" />
    <PackageReference Include="System.Reflection.Emit" Version="4.7.0" />
    <PackageReference Include="System.Reflection.Emit.ILGeneration" Version="4.7.0" />
    <PackageReference Include="System.ServiceModel.Duplex" Version="4.8.1" />
    <PackageReference Include="System.ServiceModel.Http" Version="4.8.1" />
    <PackageReference Include="System.ServiceModel.NetTcp" Version="4.8.1" />
    <PackageReference Include="System.ServiceModel.Primitives" Version="4.8.1" />
    <PackageReference Include="System.ServiceModel.Security" Version="4.8.1" />
    <PackageReference Include="XmlDoc2CmdletDoc" Version="0.4.0-dotnetcore0001" Condition="'$(TargetFramework)' == 'netcoreapp3.1'" />
  </ItemGroup>
    
  <ItemGroup>
    <WCFMetadata Include="Connected Services" />
  </ItemGroup>

  <ItemGroup>
    <Compile Update="ISHTypeFieldSetup.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>ISHTypeFieldSetup.resx</DependentUpon>
    </Compile>
    <Compile Update="Properties\Resouces\ISHTypeFieldSetup.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>ISHTypeFieldSetup.resx</DependentUpon>
    </Compile>
  </ItemGroup>

  <ItemGroup>
    <EmbeddedResource Update="ISHTypeFieldSetup.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>ISHTypeFieldSetup.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Update="Properties\Resouces\ISHTypeFieldSetup.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>ISHTypeFieldSetup.Designer.cs</LastGenOutput>
    </EmbeddedResource>
  </ItemGroup>

  <ItemGroup>
    <None Update="ISHRemote.Format.ps1xml">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
    <None Update="ISHRemote.psm1">
      <CopyToOutputDirectory>Always</CopyToOutputDirectory>
    </None>
  </ItemGroup>

  <!-- Hack to get XmlDoc2CmdletDoc to work -->
  <PropertyGroup Condition="'$(TargetFramework)' == 'netcoreapp3.1'">
    <XmlDoc2CmdletDocToolPath>netcoreapp3.1\XmlDoc2CmdletDoc.dll</XmlDoc2CmdletDocToolPath>
    <XmlDocToolsPath>netcoreapp3.1\XmlDoc2CmdletDoc.dll</XmlDocToolsPath>
  </PropertyGroup>

  <Target Name="CopyCmdletDoc" AfterTargets="AfterBuild" Condition="'$(TargetFramework)' == 'netcoreapp3.1'">
    <Copy SourceFiles="$(TargetPath)-Help.xml" DestinationFolder="$(TargetDir.Replace(`netcoreapp3.1`,`net472`))\" />
    <Copy SourceFiles="$(TargetPath)-Help.xml" DestinationFolder="$(TargetDir.Replace(`netcoreapp3.1`,`net5.0`))\" />
  </Target>

  <!-- Generating Module Manifest -->
  <Target Name="ModuleManifest" AfterTargets="CopyCmdletDoc" Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'">
    <PropertyGroup>
      <PowerShellExe Condition=" '$(PowerShellExe)'=='' ">pwsh</PowerShellExe>
      <ManifestPath>$(TargetDir)\$(ModuleName).psd1</ManifestPath>
      <RootModule>$(ModuleName).psm1</RootModule>
      <NestedModules>&apos;$(ModuleName).dll&apos;</NestedModules>
      <FormatsToProcessPath>$(ModuleName).Format.ps1xml</FormatsToProcessPath>
    </PropertyGroup>
    <Exec Command='$(PowerShellExe) -NonInteractive -command "New-ModuleManifest -Path &apos;$(ManifestPath)&apos; -FormatsToProcess &apos;$(FormatsToProcessPath)&apos; -RootModule &apos;$(RootModule)&apos; -NestedModules @($(NestedModules)) -ModuleVersion &apos;$(ModuleVersion)&apos; -Prerelease &apos;$(Prerelease)&apos; -Guid &apos;$(ModuleGuid)&apos; -Author &apos;$(Authors)&apos; -CompanyName &apos;$(CompanyName)&apos; -Copyright &apos;$(Copyright)&apos; -Description &apos;$(ModuleDescription)&apos; -PowerShellVersion &apos;$(MinPowerShellVersion)&apos; -ClrVersion &apos;$(MinCLRVersion)&apos; -DotNetFrameworkVersion &apos;$(MinDotNetVersion)&apos; -LicenseUri &apos;$(LicenseUri)&apos; -ProjectUri &apos;$(ProjectUri)&apos;"'/>
  </Target>

  <PropertyGroup>
    <!-- Ignore warning CS1591: Missing XML comment for publicly visible type or member 'Type_or_Member' -->
    <NoWarn>1591</NoWarn>
  </PropertyGroup>

</Project>
